<tal:block tal:define="macro python:here.macros('/app/macroapp.env'); macro_edit python:here.request.update({'macro_edit':True})">
<metal_macro metal:use-macro="macro/macros/form">

<slot_script metal:fill-slot="javascripts">
    <link type="text/css" href="/extensao/css/ui.all.css" rel="Stylesheet" />
    <script type="text/javascript" src="/extensao/js/ui.dialog.js"></script>
    <style type="text/css">
    .ui-dialog { position: relative; padding: .2em; width: 300px;}
    .ui-dialog-titlebar { padding: .5em .3em .3em 1em; position: relative; height:20px;}
    .ui-dialog-title { float: left; margin: .1em 0 .2em; font-size:18px}
    .ui-dialog-titlebar-close { position: absolute; right: .3em; top: 50%; width: 19px; margin: -10px 0 0 0; padding: 1px; height: 18px; }
    .ui-dialog-titlebar-close span { display: block; margin: 1px; }
    .ui-dialog-titlebar-close:hover, .ui-dialog-titlebar-close:focus { padding: 0; }
    .ui-dialog-content { padding: .5em 1em; background: none; overflow: auto; clear:both;}
    .ui-dialog-buttonpane { text-align: left; border-width: 1px 0 0 0; background-image: none; margin: .5em 0 0 0; padding: .3em 1em .5em .4em; }
    .ui-dialog-buttonpane button { float: right; margin: .5em .4em .5em 0; cursor: pointer; padding: .2em .6em .3em .6em; line-height: 1.4em; width:auto; overflow:visible; }
    .field_veja {
        width:100%;
        border: 1px solid #9FC6D9;
        background-image:url(/imgs/fdo_form.png);
        background-repeat:repeat-x;
        background-position:25% 0;
    }
    </style>
    <script type="text/javascript" src="/extensao/js/tiny_mce/tiny_mce.js"></script>
    <script type="text/javascript">
    var IFRAMEUSE = false;
    var CHTAG = false;

    $(document).ready(function()
    {
      app_create_abas();
	  
	  $('a#a_aba_antes_depois').hide();
	  $('a#a_aba_destaque').hide();
	  
      var form = document.forms['conteudo'];
      validateElement(form.publicado_em);
      validateElement(form.expira_em);
      validateElement(form.data_edicao);
	  
	  gerHorarios();

      $("#box_diretor").dialog({autoOpen:false, height:150, modal: true, overlay: {backgroundColor:'#000', opacity:0.5},
                             buttons: {'Editar': function() {
                                 id_diretor = $('#diretor_nome').attr('id_diretor');
                                 var nome = $('#diretor_nome').attr('value');
                                 var url_imdb = $('#diretor_url_imdb').attr('value');
                                 if (!id_diretor)
                                 {
                                     alert('Nenhum diretor selecionado');
                                     return;
                                 }
                                 if (!nome)
                                 {
                                     alert('Digite o nome do diretor');
                                     return;
                                 }

                                 $('#box_diretor_wait').show();
                                 $.post(BASEMETHOD + 'editDiretor', {id_diretor:id_diretor, nome:nome, url_imdb:url_imdb},
                                 function(data) {
                                   $('#box_diretor_wait').hide();
                                   $("#box_diretor").dialog('close');
                                 });
                             },
                             'Adicionar': function() {
                                 id_diretor = undefined;
                                 var nome = $('#diretor_nome').attr('value');
                                 var url_imdb = $('#diretor_url_imdb').attr('value');
                                 if (!nome)
                                 {
                                     alert('Digite o nome do diretor');
                                     return;
                                 }
                                 $('#box_diretor_wait').show();
                                 $.post(BASEMETHOD + 'addDiretor', {nome:nome, url_imdb:url_imdb},
                                 function(data) {
                                   $('#box_diretor_wait').hide();
                                   $("#box_diretor").dialog('close')
                                 });
                             },
                             'Deletar': function() {
                                 id_diretor = undefined;
                                 diretor = $('#diretor_nome').attr('id_diretor');
                                 if (!diretor)
                                 {
                                     alert('Nenhum diretor selecionado');
                                     return;
                                 }
                                 $('#box_diretor_wait').show();
                                 $.post(BASEMETHOD + 'delDiretor', {'id_diretores:list':diretor},
                                 function(data) {
                                   id_pais = undefined;
                                   $('#box_diretor_wait').hide();
                                   $("#box_diretor").dialog('close');
                                 });
                             }, },
                             title:'Editar Diretor',
                             close: function(){
                                 $('#diretor_nome').removeAttr('id_diretor').attr('value', '');
                                 $('#diretor_url_imdb').removeAttr('id_diretor').attr('value', '');                                 
                                 popdiretor();
                             }});

      $("#box_ator").dialog({autoOpen:false, height:150, modal: true, overlay: {backgroundColor:'#000', opacity:0.5},
                             buttons: {'Editar': function() {
                                 id_ator = $('#ator_nome').attr('id_ator');
                                 var nome = $('#ator_nome').attr('value');
                                 var url_imdb = $('#ator_url_imdb').attr('value');
                                 if (!id_ator)
                                 {
                                     alert('Nenhum ator selecionado');
                                     return;
                                 }
                                 if (!nome)
                                 {
                                     alert('Digite o nome do ator');
                                     return;
                                 }

                                 $('#box_ator_wait').show();
                                 $.post(BASEMETHOD + 'editAtor', {id_ator:id_ator, nome:nome, url_imdb:url_imdb},
                                 function(data) {
                                   $('#box_ator_wait').hide();
                                   $("#box_ator").dialog('close');
                                 });
                             },
                             'Adicionar': function() {
                                 id_ator = undefined;
                                 var nome = $('#ator_nome').attr('value');
                                 var url_imdb = $('#ator_url_imdb').attr('value');
                                 if (!nome)
                                 {
                                     alert('Digite o nome do ator');
                                     return;
                                 }
                                 $('#box_ator_wait').show();
                                 $.post(BASEMETHOD + 'addAtor', {nome:nome, url_imdb:url_imdb},
                                 function(data) {
                                   $('#box_ator_wait').hide();
                                   $("#box_ator").dialog('close')
                                 });
                             },
                             'Deletar': function() {
                                 id_ator = undefined;
                                 ator = $('#ator_nome').attr('id_ator');
                                 if (!ator)
                                 {
                                     alert('Nenhum ator selecionado');
                                     return;
                                 }
                                 $('#box_ator_wait').show();
                                 $.post(BASEMETHOD + 'delAtor', {'id_atores:list':ator},
                                 function(data) {
                                   id_pais = undefined;
                                   $('#box_ator_wait').hide();
                                   $("#box_ator").dialog('close');
                                 });
                             }, },
                             title:'Editar Ator',
                             close: function(){
                                 $('#ator_nome').removeAttr('id_ator').attr('value', '');
                                 $('#ator_url_imdb').removeAttr('id_ator').attr('value', '');                                 
                                 popator();
                             }});
							 
      $("#box_cinema").dialog({autoOpen:false, height:300, modal: true, overlay: {backgroundColor:'#000', opacity:0.5},
                             buttons: {'Editar': function() {
                                 id_cinema = $('#cinema_nome').attr('id_cinema');
                                 var nome = $('#cinema_nome').attr('value');
                                 var localizacao = $('#cinema_localizacao').attr('value');
								 var endereco = $('#cinema_endereco').attr('value');
								 var fone = $('#cinema_fone').attr('value');
                                 if (!id_cinema)
                                 {
                                     alert('Nenhum cinema selecionado');
                                     return;
                                 }
                                 if (!nome)
                                 {
                                     alert('Digite o nome cinema');
                                     return;
                                 }
                                 if (!localizacao)
                                 {
                                     alert('Selecione a localização do cinema');
                                     return;
                                 }
                                 if (!endereco)
                                 {
                                     alert('Digite o endereco do cinema');
                                     return;
                                 }
                                 if (!fone)
                                 {
                                     alert('Digite o fone do cinema');
                                     return;
                                 }								 

                                 $('#box_cinema_wait').show();
                                 $.post(BASEMETHOD + 'editCinema', {id_cinema:id_cinema, nome:nome, localizacao:localizacao, endereco:endereco, fone:fone},
                                 function(data) {
                                   $('#box_cinema_wait').hide();
                                   $("#box_cinema").dialog('close');
                                 });
                             },
                             'Adicionar': function() {
                                 id_cinema = undefined;
                                 var nome = $('#cinema_nome').attr('value');
                                 var localizacao = $('#cinema_localizacao').attr('value');
								 var endereco = $('#cinema_endereco').attr('value');
								 var fone = $('#cinema_fone').attr('value');
                                 if (!nome)
                                 {
                                     alert('Digite o nome do cinema');
                                     return;
                                 }
                                 if (!localizacao)
                                 {
                                     alert('Selecione a localização do cinema');
                                     return;
                                 }
                                 if (!endereco)
                                 {
                                     alert('Digite o endereco do cinema');
                                     return;
                                 }
                                 if (!fone)
                                 {
                                     alert('Digite o fone do cinema');
                                     return;
                                 }		
								 
                                 $('#box_cinema_wait').show();
                                 $.post(BASEMETHOD + 'addCinema', {nome:nome, localizacao:localizacao, endereco:endereco, fone:fone},
                                 function(data) {
                                   $('#box_cinema_wait').hide();
                                   $("#box_cinema").dialog('close')
                                 });
                             },
                             'Deletar': function() {
                                 id_cinema = undefined;
                                 cinema = $('#cinema_nome').attr('id_cinema');
                                 if (!cinema)
                                 {
                                     alert('Nenhum cinema selecionado');
                                     return;
                                 }
                                 $('#box_cinema_wait').show();
                                 $.post(BASEMETHOD + 'delCinema', {'id_cinemas:list':cinema},
                                 function(data) {
                                   id_pais = undefined;
                                   $('#box_cinema_wait').hide();
                                   $("#box_cinema").dialog('close');
                                 });
                             }, },
                             title:'Editar cinema',
                             close: function(){
                                 $('#cinema_nome').removeAttr('id_cinema').attr('value', '');
                                 $('#cinema_localizacao').removeAttr('id_cinema').attr('value', '');
								 $('#cinema_endereco').removeAttr('id_cinema').attr('value', '');
								 $('#cinema_fone').removeAttr('id_cinema').attr('value', '');
                                 popcinema();
                             }});

    });
    function validaForm(exportar)
    {
        var form = document.forms['conteudo'];
        var errs = [];
        with (form)
        {
		    /*
            if (tipo.options[tipo.selectedIndex].value == '8')
            {
                if (tags.value.search('celular') < 0)
                    tags.value = tags.value + '\ncelular';
            }
			*/

            if (isEmpty(titulo.value))
                errs.push('O campo t&iacute;tulo &eacute; obrigat&oacute;rio.');
			if (isEmpty(descricao.value))
                errs.push('O campo duração &eacute; obrigat&oacute;rio.');
            if (genero.selectedIndex <= 0)
                errs.push('O campo g&ecirc;nero &eacute; obrigat&oacute;rio.');
            if (censura.selectedIndex <= 0)
                errs.push('O campo censura &eacute; obrigat&oacute;rio.');
            if (status.selectedIndex <= 0)
                errs.push('O campo status &eacute; obrigat&oacute;rio.');
			if (diretor1.selectedIndex <= 0)
                errs.push('O campo diretor1 &eacute; obrigat&oacute;rio.');
			if (ator1.selectedIndex <= 0)
                errs.push('O campo ator1 &eacute; obrigat&oacute;rio.');
            if ((document.getElementById('tipo_corpo_N').checked) && (isEmpty(editor_normal.value)))
                errs.push('O campo sinopse &eacute; obrigat&oacute;rio.');
            if ((document.getElementById('tipo_corpo_E').checked) && (isEmpty(editor_full.value)))
                errs.push('O campo sinopse &eacute; obrigat&oacute;rio.');
            if (isEmpty(publicado_em.value))
                errs.push('O campo publicado em &eacute; obrigat&oacute;rio.');
			if (isEmpty(imagem1.value))
                errs.push('O campo foto imagem &eacute; obrigat&oacute;rio.');
			if (isEmpty(embed1.value))
                errs.push('O campo video embed &eacute; obrigat&oacute;rio.');
				
			ncin = 1;
			$('#div_aba_cinemas select.cinema').each(function(i, item) {
				if (item[item.selectedIndex].value == '')
				{
					errs.push('O campo cinema(cinema'+ncin+') &eacute; obrigat&oacute;rio.');
					ncin ++;
				}
			});					
				
			$('#div_aba_cinemas span.spanAba').clone().each(
				 function(n)
				 {
					 var ni = n+1;
					 var form = document.forms['conteudo'];
					 var sala = form['sala' + ni];
					 if (sala.selectedIndex <= 0)
						errs.push('O campo sala(cinema'+ni+') &eacute; obrigat&oacute;rio.');
					 var hora = form['hora' + ni];	
					 var minuto = form['minuto' + ni];
					 if(hora.length != 25) {
						 for(i = 0; i < hora.length; i++){
							 if (hora[i].selectedIndex <= 0)
								errs.push('O campo hora'+(i+1)+'(cinema'+ni+') &eacute; obrigat&oacute;rio.');
							 if (minuto[i].selectedIndex <= 0)
								errs.push('O campo minuto'+(i+1)+'(cinema'+ni+') &eacute; obrigat&oacute;rio.');
						 }
					 } 
					 else {
						 if (hora.selectedIndex <= 0)
							errs.push('O campo hora1(cinema'+ni+') &eacute; obrigat&oacute;rio.');
						 if (minuto.selectedIndex <= 0)
							errs.push('O campo minuto1(cinema'+ni+') &eacute; obrigat&oacute;rio.');
					 }
				 }
			);

            // portal default
            app_validate_form(errs, document.forms['conteudo']);

            if (errs.length > 0)
            {
                showError(errs);

            } else {
                app_form_aguarde(false);
                var dados = {};

                if (exportar) dados['exportar'] = 1;
                // portal default
                app_popule_action(dados, document.forms['conteudo']);

                dados['id_site'] = (window.ID_SITE_COMPARTILHAR ? window.ID_SITE_COMPARTILHAR:ID_SITE);
                dados['id_treeapp'] = (window.ID_TREE_COMPARTILHAR ? window.ID_TREE_COMPARTILHAR:ID_TREEAPP);
                dados['id_aplicativo'] = (window.ID_APLICATIVO_COMPARTILHAR ? window.ID_APLICATIVO_COMPARTILHAR:ID_APLICATIVO);
                dados['id_conteudo'] = ID_CONTEUDO;

                dados['titulo'] = titulo.value.replace('+', '%2b', 'g');
                dados['titulo_original'] = titulo_original.value.replace('+', '%2b', 'g');
                dados['url_imdb'] = url_imdb.value;
                dados['descricao'] = descricao.value.replace('+', '%2b', 'g');
                if (document.getElementById('tipo_corpo_E').checked == true)
                    dados['editor'] = 1;
                dados['genero'] = genero.options[genero.selectedIndex].value;
				dados['censura'] = censura.options[censura.selectedIndex].value;
				dados['status'] = status.options[status.selectedIndex].value;

                var dire = [];
                ndire = 1;
                $('#box_diretores > div > select').each(function(i, item) {

                    if (item[item.selectedIndex].value != '')
                    {
                        dire.push( item[item.selectedIndex].value );
                        dados['ddiretor'+ ndire +'.nome:record'] = $(item[item.selectedIndex]).value;
                        dados['ddiretor'+ ndire +'.url_imdb:record'] = $(item[item.selectedIndex]).attr('url_imdb');
                        ndire ++;
                    }
                })
                dados['diretor:list'] = dire; 
				
                var ato = [];
                nato = 1;
                $('#box_atores > div > select').each(function(i, item) {

                    if (item[item.selectedIndex].value != '')
                    {
                        ato.push( item[item.selectedIndex].value );
                        dados['dator'+ nato +'.nome:record'] = $(item[item.selectedIndex]).attr('nome');
                        dados['dator'+ nato +'.url_imdb:record'] = $(item[item.selectedIndex]).attr('url_imdb');
                        nato ++;
                    }
                })
                dados['ator:list'] = ato; 
				
                var cin = [];
                ncin = 1;
                $('#div_aba_cinemas select.cinema').each(function(i, item) {

                    if (item[item.selectedIndex].value != '')
                    {
                        cin.push( item[item.selectedIndex].value );
                        dados['dcinema'+ ncin +'.nome:record'] = $(item[item.selectedIndex]).attr('nome');
                        dados['dcinema'+ ncin +'.localizacao:record'] = $(item[item.selectedIndex]).attr('localizacao');
						dados['dcinema'+ ncin +'.endereco:record'] = $(item[item.selectedIndex]).attr('endereco');
						dados['dcinema'+ ncin +'.fone:record'] = $(item[item.selectedIndex]).attr('fone');
                        ncin ++;
                    }
                })
                dados['cinema:list'] = cin; 
                // dados filme_cinema
                var sal = [];
                var hor = [];
                var leg = [];
                var tre = [];
                var ati = [];
                $('#div_aba_cinemas span.spanAba').clone().each(
                 function(n)
                 {
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var sala = form['sala' + ni];
					 
                     var hora = form['hora' + ni];	
                     var minuto = form['minuto' + ni];
                     var horariosdesc = form['horariosdesc' + ni];	
					 var horarios = "";
					 if(hora.length != 25) {
						 for(i = 0; i < hora.length; i++){
							if(i == 0)
								horarios = horarios+hora[i].value+':'+minuto[i].value+':'+horariosdesc[i].value;
							else
								horarios = horarios+';'+hora[i].value+':'+minuto[i].value+':'+horariosdesc[i].value;
						 }
					 } 
					 else {
						horarios = horarios+hora.value+':'+minuto.value+':'+horariosdesc.value;
					 }
					 
                     var legendado = form['legendado' + ni];
                     var tresd = form['tresd' + ni];
                     var ativo = form['ativo' + ni];

                     sal.push(sala.value);
                     hor.push(horarios);
                     if (legendado[0].checked) leg.push("L");
                     else if (legendado[1].checked) leg.push("D");
					 else if (legendado[2].checked) leg.push("N");
                     if (tresd[0].checked) tre.push("1");
                     else tre.push("");
                     if (ativo[0].checked) ati.push("1");
                     else ati.push("");
                 }
                );
                dados['sala:list'] = sal;
                dados['horarios:list'] = hor;
                dados['legendado:list'] = leg;
                dados['tresd:list'] = tre;
                dados['ativo:list'] = ati;

                if (document.getElementById('tipo_corpo_N').checked == true)
                    dados['corpo'] = editor_normal.value.replace('+', '%2b', 'g');
                else {
                    dados['corpo'] = tinyMCE.getContent('editor_full').replace('+', '%2b', 'g');
                }

                if (has_video.checked == true) dados['video'] = 1;
                if (has_audio.checked == true) dados['audio'] = 1;
                if (has_galeria.checked == true) dados['galeria'] = 1;

                dados['publicado_em'] = publicado_em.value;
                dados['expira_em'] = expira_em.value;
                dados['data_edicao'] = data_edicao.value;
                if (publicado[0].checked == true)
                    dados['publicado'] = 1;

                // Fotos
                var fid = [];
                var ffg = [];
                var fc = [];
                var fl = [];
                var fd = [];
                var fli = [];
                var fal = []; 
                $('#div_aba_fotos span').clone().each(
                 function(n)
                 {
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var imagem = form['imagem' + ni];
                     var imagemgrande = form['imagemgrande' + ni];
                     var credito = form['credito' + ni];
                     var align = form['alinhamento' + ni];
                     var legenda = form['legenda' + ni];
                     var descricao = form['descricao' + ni];
                     var link = form['linkfoto' + ni];

                     fid.push(imagem.value);
                     ffg.push(imagemgrande.value);
                     fc.push(credito.value);
                     fl.push(legenda.value);
                     fd.push(descricao.value);
                     fli.push( $(link).attr('jtext') );

                     for (var num=0; num<align.length; num++)
                     {
                         if (align[num].checked == true)
                             fal.push( align[num].value );
                     }
                 }
                );
                dados['foto_id:list'] = fid;
                dados['foto_grande_id:list'] = ffg;
                dados['foto_credito:list'] = fc;
                dados['foto_legenda:list'] = fl;
                dados['foto_descricao:list'] = fd;
                dados['foto_link:list'] = fli;
                dados['foto_alinhamento:list'] = fal;
                
                // Fotos Antes- Depois
                var fid = [];
                var ffg = [];
                var fca = [];
                var fcd = [];
                var fl = [];
                var fli = [];
                var fal = []; 
                $('#div_aba_antes_depois span').clone().each(
                 function(n)
                 {
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var imagem_antes = form['imagemantes' + ni];
                     var imagem_depois= form['imagemdepois' + ni];
                     var credito_antes = form['creditoantes' + ni];
                     var credito_depois = form['creditodepois' + ni];
                     var align = form['alinhamentoad' + ni];
                     var legenda = form['legendaad' + ni];
                     var link = form['linkfotoad' + ni];

                     fid.push(imagem_antes.value);
                     ffg.push(imagem_depois.value);
                     fca.push(credito_antes.value);
                     fcd.push(credito_depois.value);
                     fl.push(legenda.value);
                     fli.push( $(link).attr('jtext') );

                     for (var num=0; num<align.length; num++)
                     {
                         if (align[num].checked == true)
                             fal.push( align[num].value );
                     }
                 }
                );
                dados['foto_antes:list'] = fid;
                dados['foto_depois:list'] = ffg;
                dados['foto_credito_antes:list'] = fca;
                dados['foto_credito_depois:list'] = fcd;
                dados['foto_legenda_antes_depois:list'] = fl;
                dados['foto_link_ad:list'] = fli;
                dados['foto_alinhamento_ad:list'] = fal;

                // Videos
                var vid = [];
                $('#div_aba_videos span').each(function(n){
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var embed = form['embed' + ni].value;
                     vid.push( embed );
                });
                dados['videos:list'] = vid;

				//console.log(dados);
				
                $.ajax({
                  type: "POST",
                  url: getMethodContent(),
                  data: dados,
                  beforeSend: function(x) {
                    if(x && x.overrideMimeType) {
                      x.overrideMimeType("application/j-son;charset=UTF-8");
                    }
                  },
                  dataType: "json",
                  success: function(res){
                     if (res['ok'])
                     {
                       showOk(res['ok']);
                       abrirF5Listagem('/app/listarcontent.env?edicao=1&id_site=' + (window.ID_SITE_COMPARTILHAR ? window.ID_SITE_COMPARTILHAR:ID_SITE) + '&id_treeapp=' + (window.ID_TREE_COMPARTILHAR ? window.ID_TREE_COMPARTILHAR:ID_TREEAPP) );
                       if (window.ID_SITE_COMPARTILHAR)
                           resetFilme();
                     } else {
                       showError([res['error']]);
                     }
                     app_form_aguarde(true);
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) { 
                  }
                });
            }
        }
    }
	
	function buttonsAdd(isNew){
        var btnEditar1 = $('.ui-dialog-buttonpane button').eq(0);
        var btnEditar2 = $('.ui-dialog-buttonpane button').eq(3);
        var btnEditar3 = $('.ui-dialog-buttonpane button').eq(6);
        var btnAdicionar1 = $('.ui-dialog-buttonpane button').eq(1);
        var btnAdicionar2 = $('.ui-dialog-buttonpane button').eq(4);
        var btnAdicionar3 = $('.ui-dialog-buttonpane button').eq(7);
        var btnDeletar1 = $('.ui-dialog-buttonpane button').eq(2);
        var btnDeletar2 = $('.ui-dialog-buttonpane button').eq(5);
        var btnDeletar3 = $('.ui-dialog-buttonpane button').eq(8);
		if(isNew) {
		    btnEditar1.hide();
            btnEditar2.hide();
            btnEditar3.hide();
            btnAdicionar1.show();
            btnAdicionar2.show();
            btnAdicionar3.show();
            btnDeletar1.hide();
            btnDeletar2.hide();
            btnDeletar3.hide();
			$('#ui-dialog-title-box_diretor').text("Novo Diretor");
			$('#ui-dialog-title-box_ator').text("Novo Ator");
			$('#ui-dialog-title-box_cinema').text("Novo Cinema");
		} else {
		    btnEditar1.show();
            btnEditar2.show();
            btnEditar3.show();
            btnAdicionar1.hide();
            btnAdicionar2.hide();
            btnAdicionar3.hide();
            btnDeletar1.hide();
            btnDeletar2.hide();
            btnDeletar3.hide();
			$('#ui-dialog-title-box_diretor').text("Editar Diretor");
			$('#ui-dialog-title-box_ator').text("Editar Ator");
			$('#ui-dialog-title-box_cinema').text("Editar Cinema");
		}
	}

    var id_sel_diretor;
    var id_diretor;
    function addNewDiretor(el)
    {
        var isNew = true;
        id_sel_diretor = el;
        var box = $('#diretor_nome');
        var url_imdb = $('#diretor_url_imdb');
        var el = document.getElementById(el);
        el = $(el.options[el.selectedIndex]);
        if (el.attr('value'))
        {
		    isNew = false;
            box.attr('value', el.text()).attr('id_diretor', el.attr('value'));
            url_imdb.attr('value', el.attr('url_imdb') );
        }
        $("#box_diretor").dialog('open');
		buttonsAdd(isNew);
    }
    function popdiretor()
    {
        var diretor1 = $('#diretor1');
        var diretor2 = $('#diretor2');
        diretor1.empty().append( $('<'+'option selected="'+ (!id_diretor ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        diretor2.empty().append( $('<'+'option selected="'+ (!id_diretor ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        seli = -1;
        $.getJSON(BASEMETHOD + 'getDiretores', {}, function(json){
           for (i=0; i<json.length; i++)
           {
             if (parseInt(id_diretor) == parseInt(json[i]['id_diretor']))
                 seli = i;
             diretor1.append( $('<'+'option value="'+json[i]['id_diretor']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
             diretor2.append( $('<'+'option value="'+json[i]['id_diretor']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
           }

           $('#box_diretores > div > select').each(function(j, item){

               if (j >= 2)
               {
                   $(item).empty().append( $('<'+'option selected="selected" value=""'+'>Selecione<'+'/option'+'>') );
                   for (i=0; i<json.length; i++)
                   {
                       $(item).append( $('<'+'option value="'+json[i]['id_diretor']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
                   } 
               }

           });

           document.getElementById('diretor1').selectedIndex = seli+1;
           document.getElementById('diretor2').selectedIndex = seli+1;
           id_diretor = undefined;
        });
    }
    function addNewComboDiretor()
    {
      var n = $('#box_diretores > div').length;
      var box = $('<div class="formu"><label for="diretor2">Diretor ' + (n + 1)  + ':</label></div>');
      $('#box_diretores > div:last > select').clone().appendTo(box);
      $('<a href="javascript:void(0)" onclick="delComboDiretor(this)"><img src="/imgs/minu.gif" /></a>').appendTo(box);
      box.appendTo('#box_diretores');
    }
    function delComboDiretor(n)
    {
      $(n.parentNode).remove()
    }
	
    var id_sel_ator;
    var id_ator;
    function addNewAtor(el)
    {
	    var isNew = true;
        id_sel_ator = el;
        var box = $('#ator_nome');
        var url_imdb = $('#ator_url_imdb');
        var el = document.getElementById(el);
        el = $(el.options[el.selectedIndex]);
        if (el.attr('value'))
        {
		    isNew = false;
            box.attr('value', el.text()).attr('id_ator', el.attr('value'));
            url_imdb.attr('value', el.attr('url_imdb') );
        }
        $("#box_ator").dialog('open');
		buttonsAdd(isNew);
    }
    function popator()
    {
        var ator1 = $('#ator1');
        var ator2 = $('#ator2');
        ator1.empty().append( $('<'+'option selected="'+ (!id_ator ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        ator2.empty().append( $('<'+'option selected="'+ (!id_ator ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        seli = -1;
        $.getJSON(BASEMETHOD + 'getAtores', {}, function(json){
           for (i=0; i<json.length; i++)
           {
             if (parseInt(id_ator) == parseInt(json[i]['id_ator']))
                 seli = i;
             ator1.append( $('<'+'option value="'+json[i]['id_ator']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
             ator2.append( $('<'+'option value="'+json[i]['id_ator']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
           }

           $('#box_atores > div > select').each(function(j, item){

               if (j >= 2)
               {
                   $(item).empty().append( $('<'+'option selected="selected" value=""'+'>Selecione<'+'/option'+'>') );
                   for (i=0; i<json.length; i++)
                   {
                       $(item).append( $('<'+'option value="'+json[i]['id_ator']+'" nome="'+ json[i]['nome'] +'" url_imdb="' + json[i]['url_imdb'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
                   } 
               }

           });

           document.getElementById('ator1').selectedIndex = seli+1;
           document.getElementById('ator2').selectedIndex = seli+1;
           id_ator = undefined;
        });
    }
    function addNewComboAtor()
    {
      var n = $('#box_atores > div').length;
      var box = $('<div class="formu"><label for="ator2">Ator ' + (n + 1)  + ':</label></div>');
      $('#box_atores > div:last > select').clone().appendTo(box);
      $('<a href="javascript:void(0)" onclick="delComboAtor(this)"><img src="/imgs/minu.gif" /></a>').appendTo(box);
      box.appendTo('#box_atores');
    }
    function delComboAtor(n)
    {
      $(n.parentNode).remove()
    }
	
    var id_sel_cinema;
    var id_cinema;
    function addNewCinema(el)
    {
	    var isNew = true;
        id_sel_cinema = el;
        var box = $('#cinema_nome');
        var localizacao = $('#cinema_localizacao');
        var endereco = $('#cinema_endereco');
        var fone = $('#cinema_fone');
        var el = document.getElementById(el);
        el = $(el.options[el.selectedIndex]);
        if (el.attr('value'))
        {
		    isNew = false;
            box.attr('value', el.text()).attr('id_cinema', el.attr('value'));
            localizacao.attr('value', el.attr('localizacao') );
            endereco.attr('value', el.attr('endereco') );
            fone.attr('value', el.attr('fone') );
        }
        $("#box_cinema").dialog('open');
		buttonsAdd(isNew);
    }
    function popcinema()
    {
        var cinema1 = $('#cinema1');
        cinema1.empty().append( $('<'+'option selected="'+ (!id_cinema ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        seli = -1;
        $.getJSON(BASEMETHOD + 'getCinemas', {}, function(json){
           for (i=0; i<json.length; i++)
           {
             if (parseInt(id_cinema) == parseInt(json[i]['id_cinema']))
                 seli = i;
             cinema1.append( $('<'+'option value="'+json[i]['id_cinema']+'" nome="'+ json[i]['nome'] +'" localizacao="' + json[i]['localizacao'] +'" endereco="' + json[i]['endereco'] +'"  fone="' + json[i]['fone'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
           }

           $('#div_aba_cinemas select.cinema').each(function(j, item){

               if (j >= 1)
               {
                   $(item).empty().append( $('<'+'option selected="selected" value=""'+'>Selecione<'+'/option'+'>') );
                   for (i=0; i<json.length; i++)
                   {
                       $(item).append( $('<'+'option value="'+json[i]['id_cinema']+'" nome="'+ json[i]['nome'] +'" localizacao="' + json[i]['localizacao'] +'" endereco="' + json[i]['endereco'] +'" fone="' + json[i]['fone'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
                   } 
               }

           });

           document.getElementById('cinema1').selectedIndex = seli+1;
           id_cinema = undefined;
        });
    }
    function addNewComboCinema()
    {
      var n = $('#box_cinemas > div').length;
      var box = $('<div class="formu"><label for="cinema2">Cinema ' + (n + 1)  + ':</label></div>');
      $('#box_cinemas > div:last > select').clone().appendTo(box);
      $('<a href="javascript:void(0)" onclick="delComboCinema(this)"><img src="/imgs/minu.gif" /></a>').appendTo(box);
      box.appendTo('#box_cinemas');
    }
    function delComboCinema(n)
    {
      $(n.parentNode).remove()
    }

    tinyMCE.init({
        mode : "specific_textareas",
        theme : "advanced",
        plugins : "advlink",
        language : "pt",
        theme_advanced_buttons1_add_before : "bold,italic,underline,strikethrough,separator,justifyleft,justifycenter,justifyright,justifyfull,separator,forecolor,separator,bullist,numlist,separator,link,unlink",
        theme_advanced_disable : "backcolor,link,unlink,undo,redo,bullist,numlist,separator,justifyleft,justifycenter,justifyright,justifyfull,bold,italic,underline,strikethrough,outdent,indent,image,cleanup,help,code,hr,removeformat,formatselect,fontselect,fontsizeselect,styleselect,sub,sup,charmap,visualaid,anchor",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        content_css : "example_word.css",
        file_browser_callback : "fileBrowserCallBack",
        cleanup_on_startup : true,
        force_br_newlines : true,
        convert_newlines_to_brs : true,
        paste_use_dialog : false,
        theme_advanced_resizing : false,
        theme_advanced_resize_horizontal : false,
        theme_advanced_link_targets : "_something=My somthing;_something2=My somthing2;_something3=My somthing3;",
        paste_auto_cleanup_on_paste : true,
        paste_convert_headers_to_strong : false,
        paste_strip_class_attributes : "all",
        paste_remove_spans : false,
        paste_remove_styles : true
    })
    function resetFilme()
    {
        var form = document.forms['conteudo'];
        var dt = new Date();
        var year = dt.getFullYear();
        var month = dt.getMonth() + 1;
        if (month < 10) month = '0' + month;
        var day = dt.getDate();
        if (day < 10) day = '0' + day;
        var hora = dt.getHours();
        if (hora < 10) hora = '0' + hora;
        var minute = dt.getMinutes();
        if (minute < 10) minute = '0' + minute;

        form.reset();
        with (form)
        {
            tipo_corpo[0].checked = true;
            tipo_corpo[0].onclick();
            editor_normal.value = '';
            /*document.getElementById('count_titulo').innerHTML = '0';
            document.getElementById('count_resumo').innerHTML = '0';*/
        }
        clearArquivos();
        $('#div_aba_fotos span').each(
          function(n, item)
          {
              if (n > 0) $(this).remove();
          }
        )
        $('#div_aba_videos span').each(
          function(n, item)
          {
              if (n > 0) $(this).remove();
          }
        )
        $('#div_aba_cinemas span.spanAba').each(
          function(n, item)
          {
              if (n > 0) $(this).remove();
          }
        )
        $('#horarios1').each(
          function(n, item)
          {
              if (n > 0) $(this).remove();
          }
		)
		
        editComboImg();
        relacionamento.clean();
        mudarAba('geral');
        form.publicado_em.value = day + '/' + month + '/' + year + ' ' + hora + ':' + minute;
    }
    function getMethodContent()
    {
        if (!window.compt || window.desbloq == false)
            return base + "editFilme";

        var base = (window.ID_SITE_COMPARTILHAR ? BASEMETHODC:BASEMETHOD);
        if (window.ID_SITE_COMPARTILHAR)
            return base + "addFilme";
        else
            return base + "editFilme";
    }
    function selectTipoCorpo()
    {
        var tN = document.getElementById('tipo_corpo_N');
        var tE = document.getElementById('tipo_corpo_E');
        var tipoCorpo = '';
        if (tN.checked)
            tipoCorpo = 'normal';
        else if (tE.checked)
            tipoCorpo = 'editor';
        return tipoCorpo;
    }
    function insertPicsBody(obj)
    {
        var tipoCorpo = selectTipoCorpo();
        var opt = obj.getElementsByTagName('option');
        var objTextArea = document.getElementById('editor_normal');
        var objTextAreaEditor = document.getElementById('editor_full');
        if (obj.selectedIndex == 0)
        {
            return;
        } else {
            for (var i=0; i<opt.length; i++)
            {
                if (opt[i].selected)
                {
                    var strTexto = opt[i].value;
                    if (tipoCorpo == 'normal')
                    {
                        inserindoFotoTextoNormal(objTextArea, strTexto);
                    } else {
                        inserindoFotoTextoEditor(objTextAreaEditor, strTexto);
                    }
                }
            }
        }
        obj.selectedIndex = 0;
    }
    function inserindoFotoTextoNormal(objTextArea, strTexto)
    {
        if (navigator.appName.indexOf("Netscape")!=-1)
        {
            strValor = objTextArea.value;
            objTextArea.value = strValor.substr(0, objTextArea.selectionStart) + strTexto + strValor.substr(objTextArea.selectionStart, strValor.length);
        } else {
            objTextArea.focus();
            var objRange = document.selection.createRange();
            objRange.text = strTexto;
        }
        objTextArea.focus();
        return 1;
    }
    function execCommand(command, user_interface, value)
    {
      var inst = tinyMCE.selectedInstance;
      inst.execCommand(command, user_interface, value);
    }
    function insertAction(valor)
    {
        var inst = tinyMCE.getInstanceById('editor_full');
        var elm = inst.getFocusElement();
        elm = tinyMCE.getParentElement(elm, "a");
        execCommand("mceBeginUndoLevel");

        if (elm == null)
        {
          var ea = $('<' + 'a>' + inst.selection.getSelectedHTML() + '<' + '/a>');
          ea.attr('href', '#h2href:' + valor)
          execCommand("mceInsertContent", false, $('<' + 'span>' + '<' + '/span>').append(ea).html());

          var elementArray = tinyMCE.getElementsByAttributeValue(inst.getBody(), "a", "href", "#mce_temp_url#");
          for (var i=0; i<elementArray.length; i++)
          {
            var elm = elementArray[i];
            if (tinyMCE.isGecko)
            {
              var sp = inst.getDoc().createTextNode(" ");
              if (elm.nextSibling)
                elm.parentNode.insertBefore(sp, elm.nextSibling);
              else
                elm.parentNode.appendChild(sp);

              var rng = inst.getDoc().createRange();
              rng.setStartAfter(elm);
              rng.setEndAfter(elm);

              var sel = inst.getSel();
              sel.removeAllRanges();
              sel.addRange(rng);
            }
            setAllAttribs(elm);
          }
        }
    }
    function inserindoFotoTextoEditor(objTextAreaEditor, strTexto)
    {
        try {
            var inst = tinyMCE.getInstanceById(tinyMCE.getWindowArg('editor_id'));
            execCommand("mceInsertContent", false, strTexto);
        } catch(e) {}
        return 1;
    }
    /** EDIT **/
    function showNormalEditor()
    {
        var normaleditor = document.getElementById('normaleditor');
        var fulleditor = document.getElementById('fulleditor');

        fulleditor.style.display = 'none';
        normaleditor.style.display = 'block';

        document.getElementById('editor_normal').value = tinyMCE.getContent('editor_full').replace('&amp;', '&', 'g');
        document.getElementById('editor_normal').value = tinyMCE.getContent('editor_full').replace('<br /' + '>', '\n', 'g');

    }
    function showFullEditor()
    {
        var normaleditor = document.getElementById('normaleditor');
        var fulleditor = document.getElementById('fulleditor');

        fulleditor.style.display = 'block';
        normaleditor.style.display = 'none';

        var editorFull = document.getElementById('editor_full');
        var editorNorm = document.getElementById('editor_normal');

        editorFull.value = editorNorm.value.replace('\n', '<br' + '/' + '>', 'g');
        tinyMCE.updateContent('editor_full');
    }

    function editComboImg()
    {
        $('#inserirFotosCorpo').empty();
        var opt = new Option('Marcadores', '');
        $('#inserirFotosCorpo').append(opt);

        var opt = new Option('Veja Mais', '[SAIBAMAIS]');
        $('#inserirFotosCorpo').append(opt);

        $('#div_aba_fotos span').each(
          function(i, item)
          {
            var srct = '[FOTO' + (i+1) + ']';
            var opt = new Option('Foto ' + (i+1), srct);
            $('#inserirFotosCorpo').append(opt);
          }
        );
        $('#div_aba_videos span').each(
          function(i, item)
          {
            var srct = '[VIDEO' + (i+1) + ']';
            var opt = new Option('Video ' + (i+1), srct);
            $('#inserirFotosCorpo').append(opt);
          }
        );
        $('#div_aba_antes_depois span').each(
          function(i, item)
          {
            var srct = '[COMPARACAO' + (i+1) + ']';
            var opt = new Option('Comparacao ' + (i+1), srct);
            $('#inserirFotosCorpo').append(opt);
          }
        );

    }
    function editNameFotos()
    {
        $('#div_aba_fotos span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
            })

            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
            })
            $(this).find('label:first').text('Foto '+ nitem).wrap('<b' +'/'+'>');
          }
        );
        editComboImg();
    }
    function addDivPhoto()
    {
        var nft = $('#div_aba_fotos span').length;
        $('#div_aba_fotos span:last-child').clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
            });
            $(this).find('input:last').map(function(i, item){
                $(item).attr('jtext', "");
            });
          }
        ).appendTo('#div_aba_fotos');
        $('#div_aba_fotos span:last-child label:first').text('Foto '+ (nft+1)).wrap('<b'+'><'+'/b>');
        editComboImg();
    }
    function delDivPhoto(obj)
    {
        var nft = $('#div_aba_fotos span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_fotos'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('input').map(
             function()
             {
                 if (this.type == 'text' || this.type == 'hidden') this.value = '';
                 if (this.getAttribute('jtext'))
                     this.setAttribute('jtext', '');
             }
            )
        }
        editNameFotos();
    }
    function editNameComp()
    {
        $('#div_aba_antes_depois span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
            })

            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
            })
            $(this).find('label:first').text('Comparacao '+ nitem).wrap('<b' +'/'+'>');
          }
        );
        editComboImg();
    }
    function addDivComp()
    {
        var nft = $('#div_aba_antes_depois span').length;
        $('#div_aba_antes_depois span:last-child').clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.getAttribute('jtext'))
                    this.setAttribute('jtext', '');
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
            });
            $(this).find('input:last').map(function(i, item){
                $(item).attr('jtext', "");
            });
          }
        ).appendTo('#div_aba_antes_depois');
        $('#div_aba_antes_depois span:last-child label:first').text('Comparacao '+ (nft+1)).wrap('<b'+'><'+'/b>');
        editComboImg();
    }
    function delDivComp(obj)
    {
        var nft = $('#div_aba_antes_depois span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_antes_depois'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('input').map(
             function()
             {
                 if (this.type == 'text' || this.type == 'hidden') this.value = '';
                 if (this.getAttribute('jtext'))
                     this.setAttribute('jtext', '');
             }
            )
        }
        editNameComp();
    }
    function editNameVideos()
    {
        $('#div_aba_videos span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
          }
        );
        editComboImg();
    }
    function addDivVideo()
    {
        var nft = $('#div_aba_videos span').length;
        $('#div_aba_videos span:last-child').clone().each(
          function()
          {
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.value = '';
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
          }
        ).appendTo('#div_aba_videos');
        $('#div_aba_videos span:last-child label:first').text('Video '+ (nft+1)).wrap('<b'+'><'+'/b>');
        editComboImg();
    }
    function delDivVideo(obj)
    {
        var nft = $('#div_aba_videos span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_videos'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('textarea').map( function() { this.value = ''; } )
        }
        editNameVideos();
    }
	
    function editNameCinemas()
    {
        $('#div_aba_cinemas span.spanAba').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('select').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
          }
        );
    }
    function addDivCinema()
    {
        var nft = $('#div_aba_cinemas span.spanAba').length;
        $('#div_aba_cinemas span.spanAba:last-child').clone().each(
          function()
          {
            $(this).find('div[id*="horarios"]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
				var aux = 0;
				$(this).find('.formu').each(function() {
				    if (aux != 0)
						$(this).remove();
					aux = 1;
				});
            });
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.value = '';
            });
            $(this).find('select').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.value = '';
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
          }
        ).appendTo('#div_aba_cinemas');
        $('#div_aba_cinemas span.spanAba:last-child label:first').text('Cinema '+ (nft+1)).wrap('<b'+'><'+'/b>');
		
		gerHorarios();
    }
    function delDivCinema(obj)
    {
        var nft = $('#div_aba_cinemas span.spanAba').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_cinemas'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('input').map( function() { this.value = ''; } )
        }
        editNameCinemas();
    }
	
    function viewTipoLink(obj)
    {
        while (obj.tagName.toLowerCase() != 'tr')
            obj = obj.parentNode;
        var input = obj.getElementsByTagName('input')[0];

        showTipoLink(input.getAttribute('id'), function(id_campo, jtext, titulo){
            var input = document.getElementById(id_campo);
            input.value = titulo;
            input.setAttribute('jtext', jtext);
        });
    }
	
	
	function gerHorarios() {
	  $('a.addHorario').click(function() {
		$(this).parents('.formu').eq(0).clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.value = '';
            });
            $(this).find('select').map(function(){
                this.value = '';
            });
            $(this).find('a.addHorario').map(function(){
                $(this).attr('class', 'delHorario');
				$(this).find('img').attr('src', '/imgs/minu.gif')
            });
          }
        ).appendTo($(this).parents('div[id*="horarios"]').eq(0));
		
		$('a.delHorario').click(function() {
			$(this).parents('.formu').eq(0).remove();
		});
		
	  });	
	}
    </script>

</slot_script>

<slot_titulo metal:fill-slot="titulo">Editar Filme</slot_titulo>

<slot_ajuda metal:fill-slot="ajuda">
  Editar filme:<br/>
  <li>Utilize a aba de "Fotos" para inserir as fotos do filme. Para utiliz&aacute;-las dentro do filme, volte para a aba "Geral" e selecione uma foto no local do filme que voc&ecirc; quer que a mesma apare&ccedil;a.</li>
  <li>Use o modo editor para alterar o layout do filme.</li>
  <li>Caso n&otilde;o exista um diretor/ator/cinema respons&aacute;vel pelo filme, cadastre um no item "Diretor/Ator/Cinema" no menu da esquerda.</li>
  <li>O Relacionamento pode enriquecer mais o conte&uacute;do do filme. vincule ao filme um v&iacute;deo, audio ou outro filme.</li>
  <li>Os campos da aba 'Destaque' podem ser utilizados por alguma listagem ou uma pequena exibi&ccedil;&atilde;o deste conte&uacute;do.</li>
  <tal:block tal:condition="python:configuracao.get('titulo_destaque', None) or configuracao.get('descricao_destaque', None) or configuracao.get('imagem_destaque', None)">
  <li>Pela configura&ccedil;&atilde;o desta folder, os campos da aba 'Destaque' s&atilde;o obrigat&oacute;rios.</li>
  </tal:block>
  <tal:block tal:condition="python:not configuracao.get('titulo_destaque', None) and not configuracao.get('descricao_destaque', None) and not configuracao.get('imagem_destaque', None)">
  <li>Pela configura&ccedil;&atilde;o desta folder, os campos da aba 'Destaque' n&atilde;o s&atilde;o obrigat&oacute;rios.</li>
  </tal:block>
</slot_ajuda>

<slot_content metal:fill-slot="content">

  <div style="height: 40px;" class="ui-dialog-content ui-widget-content" id="box_diretor">
    <fieldset>
      <div>
        <div class="formu">
          <label for="titulo">Nome:</label>
          <input type="text" class="" name="diretor_nome" id="diretor_nome" />
        </div>
        <div class="formu">
          <label for="titulo">Url IMDB:</label>
          <input type="text" class="" name="diretor_url_imdb" id="diretor_url_imdb" />
        </div><br/><br/>
      </div>
      <img src="/imgs/wait.gif" alt="" id="box_diretor_wait" style="display:none" />
    </fieldset>
  </div>
  
  <div style="height: 40px;" class="ui-dialog-content ui-widget-content" id="box_ator">
    <fieldset>
      <div>
        <div class="formu">
          <label for="titulo">Nome:</label>
          <input type="text" class="" name="ator_nome" id="ator_nome" />
        </div>
        <div class="formu">
          <label for="titulo">Url IMDB:</label>
          <input type="text" class="" name="ator_url_imdb" id="ator_url_imdb" />
        </div><br/><br/>
      </div>
      <img src="/imgs/wait.gif" alt="" id="box_ator_wait" style="display:none" />
    </fieldset>
  </div>
  
  <div style="height: 40px;" class="ui-dialog-content ui-widget-content" id="box_cinema">
    <fieldset>
      <div>
        <div class="formu">
          <label for="titulo">Nome:</label>
          <input type="text" class="" name="cinema_nome" id="cinema_nome" />
        </div>
        <div class="formu">
          <label for="titulo">Cidade:</label>
          <select class="" name="cinema_localizacao" id="cinema_localizacao">
			<option value="">Selecione</option>
			<option value="1">Fortaleza</option>
			<option value="2">Juazeiro do Norte</option>
			<option value="3">Limoeiro do Norte</option>
			<option value="4">Maracanaú</option>
			<option value="5">Sobral</option>
		  </select>
        </div><br/><br/>
        <div class="formu">
          <label for="titulo">Endereço:</label>
          <input type="text" class="" name="cinema_endereco" id="cinema_endereco" />
        </div>
        <div class="formu">
          <label for="titulo">Fone:</label>
          <input type="text" class="" name="cinema_fone" id="cinema_fone" />
        </div>
      </div>
      <img src="/imgs/wait.gif" alt="" id="box_cinema_wait" style="display:none" />
    </fieldset>
  </div>
</slot_content>

<slot_content_abas metal:fill-slot="content_abas" tal:define="
                       filme python:instance._getFilme(id_conteudo);
                       n filme/filme;
                       global conteudo n;
                       fotos filme/fotos;
                       diretores filme/diretores;
                       atores filme/atores;
                       cinemas filme/cinemas;
                       fotos_ad filme/fotos_ad;
                       videos python:[i for i in filme['videos']];
                       ">

      <legend>Editar Filme</legend>
      <div id="div_aba_geral" title="Geral">
        <div class="formu">
          <label for="titulo">T&iacute;tulo:</label>
          <input type="text" class="full" name="titulo" id="titulo" tal:attributes="value n/titulo"/>
        </div><br/><br/>
        <div class="formu">
          <label for="titulo">Cartola:</label>
          <input type="text" class="full" name="titulo_original" id="titulo_original" tal:attributes="value n/titulo_original"/>
        </div><br/><br/>
        <div class="formu">
          <label for="resumo">Duração:</label>
          <input name="descricao" id="descricao" tal:attributes="value n/descricao" />
        </div><br/><br/>
		
        <div class="formu">
          <label for="resumo">Status:</label>
          <select name="status" class="full">
          <option value="">Selecione</option>
          <none tal:repeat="item python:instance._getStatus()" tal:omit-tag="">
          <option tal:attributes="value item/id_status; selected python:util.test(item['id_status'] == n['id_status'], 'selected', '')" tal:content="item/nome"></option>
          </none>
          </select>
        </div><br/><br/>

        <div class="formu">
          <label for="resumo">Genero:</label>
          <select name="genero" class="full">
          <option value="">Selecione</option>
          <none tal:repeat="item python:instance._getGenero()" tal:omit-tag="">
          <option tal:attributes="value item/id_genero; selected python:util.test(item['id_genero'] == n['id_genero'], 'selected', '')" tal:content="item/nome"></option>
          </none>
          </select>
        </div><br/><br/>
		
        <div class="formu">
          <label for="resumo">Censura:</label>
          <select name="censura" class="full">
          <option value="">Selecione</option>
          <none tal:repeat="item python:instance._getCensura()" tal:omit-tag="">
          <option tal:attributes="value item/id_censura; selected python:util.test(item['id_censura'] == n['id_censura'], 'selected', '')" tal:content="item/nome"></option>
          </none>
          </select>
        </div><br/><br/>		

        <span id="box_diretores" tal:define="diretores_ python:[i for i in instance._listarDiretores()]">
        <tal:block tal:repeat="dir diretores">
        <div class="formu">
          <label>Diretor <tal:block tal:content="repeat/dir/number">1</tal:block>:</label>
          <select name="diretor1" id="diretor1" class="full" style="width:65%" tal:attributes="name string:diretor${repeat/dir/number}; id string:diretor${repeat/dir/number}">
          <option value="">Selecione</option>

          <option tal:repeat="diretor diretores_" 
                  tal:attributes="value diretor/id_diretor; 
                                  url_imdb diretor/url_imdb; 
                                  nome diretor/nome; 
                                  selected python:util.test(dir == diretor['id_diretor'], 'selected', '')" 
                  tal:content="python: diretor['nome']">Diretor 1</option>
          </select>
          <a tal:condition="python:repeat['dir'].number() < 2" href="javascript:void(0)" onclick="addNewDiretor('diretor1')" tal:attributes="onclick string:addNewDiretor('diretor${repeat/dir/number}')"><img src="/imgs/plu.gif" /></a>
          <a tal:condition="python:repeat['dir'].number() == 2" href="javascript:void(0)" onclick="addNewComboDiretor()"><img src="/imgs/plu.gif" /></a>
          <a tal:condition="python:repeat['dir'].number() > 2" href="javascript:void(0)" onclick="delComboDiretor(this)"><img src="/imgs/minu.gif" /></a>
        </div>
        </tal:block>
        </span><br/><br/>
		
        <span id="box_atores" tal:define="atores_ python:[i for i in instance._listarAtores()]">
        <tal:block tal:repeat="ato atores">
        <div class="formu">
          <label>Ator <tal:block tal:content="repeat/ato/number">1</tal:block>:</label>
          <select name="ator1" id="ator1" class="full" style="width:65%" tal:attributes="name string:ator${repeat/ato/number}; id string:ator${repeat/ato/number}">
          <option value="">Selecione</option>

          <option tal:repeat="ator atores_" 
                  tal:attributes="value ator/id_ator; 
                                  url_imdb ator/url_imdb; 
                                  nome ator/nome; 
                                  selected python:util.test(ato == ator['id_ator'], 'selected', '')" 
                  tal:content="python: ator['nome']">Ator 1</option>
          </select>
          <a tal:condition="python:repeat['ato'].number() < 2" href="javascript:void(0)" onclick="addNewAtor('ator1')" tal:attributes="onclick string:addNewAtor('ator${repeat/ato/number}')"><img src="/imgs/plu.gif" /></a>
          <a tal:condition="python:repeat['ato'].number() == 2" href="javascript:void(0)" onclick="addNewComboAtor()"><img src="/imgs/plu.gif" /></a>
          <a tal:condition="python:repeat['ato'].number() > 2" href="javascript:void(0)" onclick="delComboAtor(this)"><img src="/imgs/minu.gif" /></a>
        </div>
        </tal:block>
        </span><br/><br/>
		
        <div class="formu">
          <label for="url_imdb">Url IMDB:</label>
          <input type="text" class="full" name="url_imdb" id="url_imdb" tal:attributes="value n/url_imdb"/>
        </div><br/><br/>

        <div class="formu" nowrap="nowrap">
          <label>Sinopse:</label>
          <label><input type="radio" id="tipo_corpo_N" name="tipo_corpo" value="1" onclick="showNormalEditor()" tal:attributes="checked python:util.test(n['editor'], '', 'checked')" /> Normal</label>
          <label><input type="radio" id="tipo_corpo_E" name="tipo_corpo" value="0" onclick="showFullEditor()" tal:attributes="checked python:util.test(n['editor'], 'checked', '')" /> Editor</label>
          <label style="width: 75px; display:none;">
            <select name="inserirFotosCorpo" id="inserirFotosCorpo" onchange="javascript:insertPicsBody(this);" style="width:95px;">
            <option value="">Marcadores</option>
            <option value="[SAIBAMAIS]">Veja Mais</option>
            <tal:block tal:repeat="i fotos">
            <option value="[FOTO1]" tal:content="string: Foto ${repeat/i/number}" tal:attributes="value string:[FOTO${repeat/i/number}]">Foto 1</option>
            </tal:block>
            <option value="[FOTO1]" tal:condition="python:len(fotos) == 0">Foto 1</option>
            <tal:block tal:repeat="i fotos_ad">
            <option value="[COMPARACAO1]" tal:content="string: Comparacao ${repeat/i/number}" tal:attributes="value string:[COMPARACAO${repeat/i/number}]">Comparacao 1</option>
            </tal:block>
            <option value="[COMPARACAO1]" tal:condition="python:len(fotos_ad) == 0">Comparacao 1</option>
            <tal:block tal:repeat="i videos">
            <option value="[VIDEO1]" tal:content="string: Video ${repeat/i/number}" tal:attributes="value string:[VIDEO${repeat/i/number}]">Video 1</option>
            </tal:block>
            <option value="[VIDEO1]" tal:condition="python:len(videos) == 0">Video 1</option>
            </select>
          </label>
        </div>
        <div class="formu" nowrap="nowrap">
          <div class="fulleditor" style="display:none" id="fulleditor" tal:attributes="style python:util.test(n['editor'], '', 'display:none')">
            <textarea mce_editable="true" id="editor_full" name="editor_full" style="width: 100%; height: 450px;" tal:content="n/corpo"></textarea>
          </div>
        </div>
        <div class="formu" id="normaleditor" tal:attributes="style python:util.test(n['editor'], 'display:none', '')">
          <textarea id="editor_normal" name="editor_normal" class="full" style="width: 100%; height: 400px;" tal:content="n/corpo"></textarea>
        </div>
        <div class="formu" style="display:none;" nowrap>
          <label>Possui:</label>
          <table>
          <tr>
            <td><input type="checkbox" id="has_video" name="has_video" value="1" tal:attributes="checked python:util.test(n['video'], 'checked', '')"/></td>
            <td><label for="has_video">V&iacute;deo</label></td>
            <td><input type="checkbox" id="has_audio" name="has_audio" value="1" tal:attributes="checked python:util.test(n['audio'], 'checked', '')"/></td>
            <td><label for="has_audio">&Aacute;udio</label></td>
            <td><input type="checkbox" id="has_galeria" name="has_galeria" value="1" tal:attributes="checked python:util.test(n['galeria'], 'checked', '')"/></td>
            <td><label for="has_galeria">Galeria</label></td>
          </tr>
          </table>
        </div><br/><br/>
		
        <div class="formu">
          <label for="campoPublicado">Publicado em:</label>
          <input type="text" name="publicado_em" format="##/##/#### ##:##" filter="0-9" tal:attributes="value n/publicado_em"/>
        </div>
        <div class="formu">
          <label for="campoExpira">Expira em:</label>
          <input type="text" name="expira_em" format="##/##/#### ##:##" filter="0-9" tal:attributes="value n/expira_em" />
        </div>
        <div class="formu">
          <label for="campoExpira">Data edi&ccedil;&atilde;o:</label>
          <input type="text" name="data_edicao" format="##/##/####" filter="0-9" tal:attributes="value n/data_edicao" />
        </div>
        <div class="formu" nowrap>
          <label><input type="radio" name="publicado" value="P" tal:attributes="checked python:util.test(n['publicado'], 'checked', '')" />&nbsp;Publicado</label>
          <label><input type="radio" name="publicado" value="R" tal:attributes="checked python:util.test(n['publicado'], '', 'checked')" />&nbsp;Rascunho</label>
        </div>

        <div class="formu">&nbsp;</div>
      </div>

      <div id="div_aba_fotos" style="display:none;" title="Fotos">
        <input type="hidden" name="contadorFotos" id="contadorFotos" value="1" tal:attributes="value python:len(fotos)"/>

        <span tal:condition="python:len(fotos) == 0">
          <div class="formu">
            <label class="full"><b>Foto</b></label>
          </div>
          <div class="formu">
            <label>Imagem:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemsrc1;
                                   global value_input string:;
                                   global name_input string:imagem1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimg1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu" style="display:none;">
            <label>Alinhamento:</label>
            <table>
            <tr>
              <td><input type="radio" name="alinhamento1" value="left" checked="checked" />Esquerda</td>
              <td><input type="radio" name="alinhamento1" value="center" /> Centralizado</td>
              <td><input type="radio" name="alinhamento1" value="right" /> Direita</td>
            </tr>
            </table>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="credito1" class="full" class="full" ></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legenda1" class="full" ></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoLegenda1">Descri&ccedil;&atilde;o da Foto:</label>
            <textarea name="descricao1" class="full" ></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoLegenda1">Link:</label>
            <table style="width:70%">
            <tr>
              <td><input type="text" style="width:90%" name="linkfoto1" id="linkfoto1" disabled="disabled" jtext=""/></td>
              <td><a href="javascript:void(0)" onclick="viewTipoLink(this)"><img src="/imgs/ico_tipo_link.gif" /></a></td>
            </tr>
            </table>
          </div>
          <div class="formu" style="display:none;">
            <label>Imagem Grande:</label>
            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemgrandesrc1;
                                   global value_input string:;
                                   global name_input string:imagemgrande1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimggrande1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">
              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu" style="text-align:right;display:none">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivPhoto()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivPhoto(this)" />
          </div>
        </span>

        <span tal:repeat="i fotos">
          <div class="formu">
            <label class="full"><b>Foto</b></label>
          </div>
          <div class="formu">
            <label>Imagem:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemsrc${repeat/i/number};
                                   global value_input i/arquivo;
                                   global name_input string:imagem${repeat/i/number};
                                   global value i/arquivo;
                                   global temp_folder python:util.test(i['arquivo'], '', '1');
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimg${repeat/i/number};
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu" style="display:none;">
            <label>Alinhamento:</label>
            <table>
            <tr>
              <td><input type="radio" name="alinhamento1" value="left" tal:attributes="name string:alinhamento${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'left', 'checked', '')" />Esquerda</td>
              <td><input type="radio" name="alinhamento1" value="center" tal:attributes="name string:alinhamento${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'center', 'checked', '')" /> Centralizado</td>
              <td><input type="radio" name="alinhamento1" value="right" tal:attributes="name string:alinhamento${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'right', 'checked', '')" /> Direita</td>
            </tr>
            </table>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="credito1" class="full" class="full" tal:content="i/credito" tal:attributes="name string:credito${repeat/i/number}"></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legenda1" class="full" tal:content="i/legenda" tal:attributes="name string:legenda${repeat/i/number}"></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoDescricao1">Descri&ccedil;&atilde;o da Foto:</label>
            <textarea name="descricao1" class="full" tal:content="i/descricao" tal:attributes="name string:descricao${repeat/i/number}"></textarea>
          </div>
          <div class="formu" style="display:none;">
            <label for="campoLegenda1">Link:</label>
            <table style="width:70%">
            <tr>
              <td><input type="text" style="width:90%" name="linkfoto1" id="linkfoto1" disabled="disabled" jtext="" tal:attributes="jtext i/link; id string:linkfoto${repeat/i/number}; name string:linkfoto${repeat/i/number};"/></td>
              <td><a href="javascript:void(0)" onclick="viewTipoLink(this)"><img src="/imgs/ico_tipo_link.gif" /></a></td>
              <script type="text/javascript" tal:content="structure python:util.py2js(IDS='linkfoto%s' % repeat['i'].number())"></script>
              <script>
              try
              {
                $('#' + IDS).attr('value', eval('(' + unescape( $('#' + IDS).attr('jtext')  ) + ')')['titulo']);
              } catch (e) { }
              </script>
            </tr>
            </table>
          </div>
          <div class="formu" style="display:none;">
            <label>Imagem Grande:</label>
            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemgrandesrc${repeat/i/number};
                                   global value_input i/arquivo_grande;
                                   global name_input string:imagemgrande${repeat/i/number};
                                   global value i/arquivo_grande;
                                   global temp_folder python:util.test(i['arquivo_grande'], '', 1);
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimggrande${repeat/i/number};
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">
              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu" style="text-align:right; display:none">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivPhoto()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivPhoto(this)" />
          </div>
        </span>

      </div>
      <div id="div_aba_antes_depois" style="display:none;" title="Antes/Depois">
        <input type="hidden" name="contadorFotos" id="contadorFotos" value="1" />
        <span tal:condition="python: len(fotos_ad) == 0">
          <div class="formu">
            <label class="full"><b>Comparacao 1</b></label>
          </div>
          <div class="formu">
            <label>Foto Antes:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemantes1;
                                   global value_input string:;
                                   global name_input string:imagemantes1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimgantes1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="creditoantes1" class="full" class="full" ></textarea>
          </div>
          <div class="formu">
            <label>Foto Depois:</label>
            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemdepois1;
                                   global value_input string:;
                                   global name_input string:imagemdepois1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimgdeoius1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">
              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="creditodepois1" class="full" class="full" ></textarea>
          </div>
          <div class="formu">
            <label>Alinhamento:</label>
            <table>
            <tr>
              <td><input type="radio" name="alinhamentoad1" value="left" checked="checked" />Esquerda</td>
              <td><input type="radio" name="alinhamentoad1" value="center" /> Centralizado</td>
              <td><input type="radio" name="alinhamentoad1" value="right" /> Direita</td>
            </tr>
            </table>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legendaad1" class="full"></textarea>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Link:</label>
            <table style="width:70%">
            <tr>
              <td><input type="text" style="width:90%" name="linkfoto1" id="linkfotoad1" disabled="disabled" jtext=""/></td>
              <td><a href="javascript:void(0)" onclick="viewTipoLink(this)"><img src="/imgs/ico_tipo_link.gif" /></a></td>
            </tr>
            </table>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivComp()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivComp(this)" />
          </div>
        </span>
        <span tal:repeat="i fotos_ad">
          <div class="formu">
            <label class="full"><b>Comparacao <none tal:content="repeat/i/number"></none></b></label>
          </div>
          <div class="formu">
            <label>Foto Antes:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemantes${repeat/i/number};
                                   global value_input i/foto_antes;
                                   global name_input string:imagemantes${repeat/i/number};
                                   global value i/foto_antes;
                                   global temp_folder python:util.test(i['foto_antes'], '', '1');
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimgantes${repeat/i/number};
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="creditoantes1" class="full" class="full" tal:content="i/credito_antes" tal:attributes="name string:creditoantes${repeat/i/number}"></textarea>
          </div>
          <div class="formu">
            <label>Foto Depois:</label>
            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemdepois${repeat/i/number};
                                   global value_input i/foto_depois;
                                   global name_input string:imagemdepois${repeat/i/number};
                                   global value i/foto_depois;
                                   global temp_folder python:util.test(i['foto_depois'], '', 1);
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimgdepois${repeat/i/number};
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">
              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="creditodepois1" class="full" class="full" tal:content="i/credito_depois" tal:attributes="name string:creditodepois${repeat/i/number}"></textarea>
          </div>
          <div class="formu">
            <label>Alinhamento:</label>
            <table>
            <tr>
              <td><input type="radio" name="alinhamentoad1" value="left" tal:attributes="name string:alinhamentoad${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'left', 'checked', '')" />Esquerda</td>
              <td><input type="radio" name="alinhamentoad1" value="center" tal:attributes="name string:alinhamentoad${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'center', 'checked', '')" /> Centralizado</td>
              <td><input type="radio" name="alinhamentoad1" value="right" tal:attributes="name string:alinhamentoad${repeat/i/number}; checked python:util.test(i['alinhamento'] == 'right', 'checked', '')" /> Direita</td>
            </tr>
            </table>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legendaad1" class="full" tal:content="i/legenda" tal:attributes="name string:legendaad${repeat/i/number}"></textarea>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Link:</label>
            <table style="width:70%">
            <tr>
              <td><input type="text" style="width:90%" name="linkfoto1" id="linkfoto1" disabled="disabled" jtext="" tal:attributes="jtext i/link; id string:linkfotoad${repeat/i/number}; name string:linkfotoad${repeat/i/number};"/></td>
              <td><a href="javascript:void(0)" onclick="viewTipoLink(this)"><img src="/imgs/ico_tipo_link.gif" /></a></td>
              <script type="text/javascript" tal:content="structure python:util.py2js(IDS='linkfotoad%s' % repeat['i'].number())"></script>
              <script>
              try
              {
                $('#' + IDS).attr('value', eval('(' + unescape( $('#' + IDS).attr('jtext')  ) + ')')['titulo']);
              } catch (e) { }
              </script>
            </tr>
            </table>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivComp()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivComp(this)" />
          </div>
        </span>

      </div>
      <div id="div_aba_videos" style="display:none;" title="V&iacute;deos">
        <input type="hidden" name="contadorVideos" id="contadorVideos" value="1" tal:attributes="value python:len(videos)"/>

        <span tal:condition="python:len(videos) == 0">
          <div class="formu">
            <label class="full"><b>V&iacute;deo 1</b></label>
          </div>
          <div class="formu">
            <label>Embed:</label>
            <textarea style="height:150px" name="embed1" class="full" class="full" name="embed1"></textarea>
          </div>
          <div class="formu" style="text-align:right;display:none;">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivVideo()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivVideo(this)" />
          </div>
        </span>

        <span tal:repeat="i videos">
          <div class="formu">
            <label class="full"><b>V&iacute;deo <tal:block tal:replace="repeat/i/number">1</tal:block></b></label>
          </div>
          <div class="formu">
            <label>Embed:</label>
            <textarea style="height:150px" name="embed1" class="full" class="full" tal:attributes="name string:embed${repeat/i/number}" tal:content="i/embed"></textarea>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivVideo()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivVideo(this)" />
          </div>
        </span>

      </div>
	  
  <div id="div_aba_cinemas" style="display:none;" title="Cinemas">
    <input type="hidden" name="contadorCinemas" id="contadorCinemas" value="1" tal:attributes="value python:len(cinemas)"/>
    <span class="spanAba" tal:condition="python:len(cinemas) == 0">
      <div class="formu">
        <label class="full"><b>Cinema 1</b></label>
      </div>
      <span id="box_cinemas" tal:define="cin python:[i for i in instance._listarCinemas()]">
      <div class="formu">
        <label for="cinema1">Cinema:</label>
        <select name="cinema1" class="full cinema" style="width:65%" id="cinema1">
        <option value="">Selecione</option>
        <option tal:repeat="cinema cin" tal:attributes="value cinema/id_cinema; nome cinema/nome; localizacao cinema/localizacao; endereco cinema/endereco; fone cinema/fone;" tal:content="python: cinema['nome']">Cinema 1</option>
        </select>
        <a href="javascript:void(0)" onclick="addNewCinema('cinema1')"><img src="/imgs/plu.gif" /></a>
      </div>
      </span><br/><br/>
	  
      <div class="formu">
        <label for="sala1">Sala:</label>
        <select class="full" name="sala1" id="sala1">
			<option value="">Selecione</option>
			<option tal:repeat="num python: range(1,16)" tal:attributes="value num" tal:content="string:Sala ${num}">Sala 1</option>
		</select>
      </div><br/><br/>
	  <div id="horarios1">
		  <div class="formu">
			<label for="horarios">Horarios:</label>
			<select id="hora1" name="hora1">
				<option value="">Hora</option>
				<option tal:repeat="num python: range(0,24)" tal:attributes="value python: util.test(len(str(num)) == 1, '0'+str(num)+'h', str(num)+'h')" tal:content="python: util.test(len(str(num)) == 1, '0'+str(num)+'h', str(num)+'h')">Sala 1</option>
			</select>
			<select id="minuto1" name="minuto1">
				<option value="">Minuto</option>
				<option tal:repeat="num python: range(0,60)" tal:attributes="value python: util.test(len(str(num)) == 1, '0'+str(num)+'min', str(num)+'min')" tal:content="python: util.test(len(str(num)) == 1, '0'+str(num)+'min', str(num)+'min')">Sala 1</option>
			</select>
			<label style="width: 5%">Obs.:</label>
			<input style="width: 40%" type="text" name="horariosdesc1" id="horariosdesc1" />
			<a href="javascript:void(0)" class="addHorario"><img src="/imgs/plu.gif" /></a>
		  </div>
	  </div><br/><br/>
      <div class="formu">
        <label for="legendado1">Legendado?:</label>
        <label><input type="radio" name="legendado1" id="legendado1" checked />&nbsp;Legendado</label>
        <label><input type="radio" name="legendado1" id="legendado1" />&nbsp;Dublado</label>
		<label><input type="radio" name="legendado1" id="legendado1" />&nbsp;Nacional</label>
      </div><br/><br/>
      <div class="formu">
        <label for="tresd1">3D?:</label>
        <label><input type="radio" name="tresd1" id="tresd1" value="1" checked />&nbsp;Sim</label>
        <label><input type="radio" name="tresd1" id="tresd1" value="" />&nbsp;Não</label>
      </div><br/><br/>
      <div class="formu">
        <label for="ativo1">Ativo?:</label>
        <label><input type="radio" name="ativo1" id="ativo1" value="1" checked />&nbsp;Sim</label>
        <label><input type="radio" name="ativo1" id="ativo1" value="" />&nbsp;Não</label>
      </div><br/><br/>
	  
      <div class="formu" style="text-align:right">
        <img alt="Adicionar" style="cursor:pointer" onclick="addDivCinema()" src="/imgs/plu.gif" />
        <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivCinema(this)" />
      </div>
    </span>
	
    <span class="spanAba" tal:repeat="i cinemas">
      <div class="formu">
        <label class="full"><b>Cinema <tal:block tal:replace="repeat/i/number">1</tal:block></b></label>
      </div>
      <span id="box_cinemas" tal:define="cin python:[i for i in instance._listarCinemas()]">
      <div class="formu">
        <label tal:attributes="for string:cinema${repeat/i/number}">Cinema:</label>
        <select class="full cinema" style="width:65%" tal:attributes="name string:cinema${repeat/i/number}; id string:cinema${repeat/i/number}">
        <option value="">Selecione</option>
        <option tal:repeat="cinema cin" tal:attributes="value cinema/id_cinema; nome cinema/nome; localizacao cinema/localizacao; endereco cinema/endereco; fone cinema/fone; selected python:util.test(cinema['id_cinema'] == i['id_cinema'], 'selected', '')" tal:content="python: cinema['nome']">Cinema 1</option>
        </select>
        <a href="javascript:void(0)" onclick="addNewCinema('cinema1')"><img src="/imgs/plu.gif" /></a>
      </div>
      </span><br/><br/>
	  
      <div class="formu">
        <label tal:attributes="for string:sala${repeat/i/number}">Sala:</label>
        <select class="full" tal:attributes="name string:sala${repeat/i/number}; id string:sala${repeat/i/number}; value i/sala">
			<option value="">Selecione</option>
			<option tal:repeat="num python: range(1,16)" tal:attributes="value num; selected python: util.test(int(num) == int(i['sala']), 'selected', '')" tal:content="string:Sala ${num}">Sala 1</option>
		</select>
      </div><br/><br/>
	  
	  <div id="horarios1" tal:define="horarios python: i['horarios'].split(';;')">
		  <div class="formu" tal:repeat="horario horarios">
		    <none tal:define="arrayHor python: horario.split(':');
			                  hora python: arrayHor[0];
							  minuto python: arrayHor[1];
							  obs python: arrayHor[2];">
				<label for="horarios">Horarios:</label>
				<select tal:attributes="name string:hora${repeat/i/number}; id string:hora${repeat/i/number}">
					<option value="">Hora</option>
					<option tal:repeat="num python: range(1,25)" tal:attributes="value python: util.test(len(str(num)) == 1, '0'+str(num)+'h', str(num)+'h'); selected python: util.test(hora == (util.test(len(str(num)) == 1, '0'+str(num)+'h', str(num)+'h')), 'selected', '')" tal:content="python: util.test(len(str(num)) == 1, '0'+str(num)+'h', str(num)+'h')">Sala 1</option>
				</select>
				<select tal:attributes="name string:minuto${repeat/i/number}; id string:minuto${repeat/i/number}">
					<option value="">Minuto</option>
					<option tal:repeat="num python: range(0,60)" tal:attributes="value python: util.test(len(str(num)) == 1, '0'+str(num)+'min', str(num)+'min'); selected python: util.test(minuto == (util.test(len(str(num)) == 1, '0'+str(num)+'min', str(num)+'min')), 'selected', '')" tal:content="python: util.test(len(str(num)) == 1, '0'+str(num)+'min', str(num)+'min')">Sala 1</option>
				</select>
				<label style="width: 5%">Obs.:</label>
				<input style="width: 40%" type="text" tal:attributes="name string:horariosdesc${repeat/i/number}; id string:horariosdesc${repeat/i/number}; value obs" />
				<a href="javascript:void(0)" class="addHorario" tal:condition="python: repeat['horario'].number() == 1"><img src="/imgs/plu.gif" /></a>
				<a href="javascript:void(0)" class="delHorario" tal:condition="python: repeat['horario'].number() != 1"><img src="/imgs/minu.gif" /></a>
			</none>
		  </div>
	  </div><br/><br/>
	  
	  
	  
      <div class="formu">
        <label tal:attributes="for string:legendado${repeat/i/number}">Legendado?:</label><br/><br/>   
        <label><input type="radio" tal:attributes="name string:legendado${repeat/i/number}; id string:legendado${repeat/i/number}; checked python:util.test(i['legendado'] == 'L', 'checked', '')" />&nbsp;Legendado</label>
        <label><input type="radio" tal:attributes="name string:legendado${repeat/i/number}; id string:legendado${repeat/i/number}; checked python:util.test(i['legendado'] == 'D', 'checked', '')" />&nbsp;Dublado</label>
		<label><input type="radio" tal:attributes="name string:legendado${repeat/i/number}; id string:legendado${repeat/i/number}; checked python:util.test(i['legendado'] == 'N', 'checked', '')" />&nbsp;Nacional</label>
		
      </div><br/><br/>
      <div class="formu">
        <label tal:attributes="for string:tresd${repeat/i/number}">3D?:</label>
        <label><input type="radio" tal:attributes="name string:tresd${repeat/i/number}; id string:tresd${repeat/i/number}; checked python:util.test(i['tresd'], 'checked', '')" value="1" />&nbsp;Sim</label>
        <label><input type="radio" tal:attributes="name string:tresd${repeat/i/number}; id string:tresd${repeat/i/number}; checked python:util.test(i['tresd'], '', 'checked')" value="" />&nbsp;Não</label>
      </div><br/><br/>
      <div class="formu">
        <label tal:attributes="for string:ativo${repeat/i/number}">Ativo?:</label>
        <label><input type="radio" tal:attributes="name string:ativo${repeat/i/number}; id string:ativo${repeat/i/number}; checked python:util.test(i['ativo'], 'checked', '')" value="1" />&nbsp;Sim</label>
        <label><input type="radio" tal:attributes="name string:ativo${repeat/i/number}; id string:ativo${repeat/i/number}; checked python:util.test(i['ativo'], '', 'checked')" value="" />&nbsp;Não</label>
      </div><br/><br/>
	  
      <div class="formu" style="text-align:right">
        <img alt="Adicionar" style="cursor:pointer" onclick="addDivCinema()" src="/imgs/plu.gif" />
        <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivCinema(this)" />
      </div>
    </span>
  </div>

</slot_content_abas>

</metal_macro>
</tal:block>
